var videos=new VideoList;videos.reset(bootstrappedVideos);var videoView=new VideoListView({attributes:{title:"Video Quick View"},collection:videos}),newNoteForm='<form id="submit-note"><textarea name="note" class="new-note" placeholder="Note..."></textarea><button class="cancel-note btn btn-danger">Cancel</button><button type="submit" class="btn btn-primary submit-note-btn">Save</button><form>',notePopover='<button class="btn btn-success popover-btn edit-note">Edit  </button><button class="btn btn-danger popover-btn delete-note">Delete</button><button id="close-popover" data-toggle="clickover" class="btn btn-small btn-primary popover-btn" onclick="$(&quot;.note-row&quot;).popover(&quot;hide&quot;);">Close</button>',timeConvert=function(e){var t=e/60,o=Math.floor(t),n=e-60*o,i=Math.floor(n),s=i.toString().split("");return 1===s.length?o+":0"+i:o+":"+i};$(function(){$("#username-input").focus(),videoView.render(),$("body").append(videoView.el),$(document).on("click",".note-row",function(e){e.stopPropagation(),$(".note-row").popover({animation:!0,content:notePopover,html:!0})}),$(document).on("click",".delete-note",function(){var e=$(this).closest("li"),t=e.find("video"),o=t.attr("id"),n=$(this).parent(),i=n.parent().prev().attr("id");$.post("/deleteNote",{id:i,videoId:o},function(e){console.log("responseData.success: ",e.success),e.success===!0&&($("#"+i).remove(),$(".popover").remove())})}),$(document).on("click",".toggle-new-note",function(){var e=$(this).closest("li"),t=e.find("video"),o=t.attr("id"),n=document.getElementById(o);n.pause();var i=e.find("table.list-notes");i.prepend(newNoteForm),$(document).on("click",".cancel-note",function(e){e.preventDefault(),$("#submit-note").remove()}),$(document).on("submit","#submit-note",function(e){e.preventDefault(),e.stopPropagation();var t=$(this).find("textarea").val(),i=$(this).closest("table"),s=n.currentTime,l=timeConvert(s);console.log(s),console.log(t),$.post("/saveNote",{id:o,note:t,time:s,displayTime:l},function(e){console.log(e)}),i.append('<tr class="note-row"><td><button class="set-time btn btn-default" data-set-time="'+s+'">'+l+"</button>"+t+"</td></tr>"),this.remove(),n.play()})}),$(document).on("click",".deleteVideo",function(){var e=$(this).closest("li"),t=e.attr("data-video-container");$.post("/deleteVideo",{id:t},function(t){console.log("responseData: ",t),t.success===!0&&e.remove()})}),$(document).on("click",".set-time",function(e){e.stopPropagation();var t=$(this).closest("li"),o=t.find("video"),n=o.attr("id"),i=document.getElementById(n),s=$(this).attr("data-set-time");i.currentTime=Number(s)}),$(document).on("click",".theater-mode",function(){var e=$(this).closest("li");console.log("YO!",e);var t=$("#theater-mode"),o=e.attr("data-video-container"),n="/theaterMode/"+o;$.get(n,{},function(e){console.log(e),$(".uploaded-video").setAttribute("data-video",o),t.modal("show")})})});var VideoList=Backbone.Collection.extend({model:Video,url:"/videos"}),Video=Backbone.Model.extend({idAttributes:"_id",defaults:{title:"Why Internet Explorer is the best",videoSrc:"",notes:[{time:0,note:""}]}}),VideoListView=Backbone.View.extend({template:Handlebars.compile($("#video-list").html()),initialize:function(){this.setElement(this.template(this.attributes)),this.listenTo(this.collection,"all",this.render)},render:function(){var e=this.collection.map(function(e){var t=new VideoView({model:e});return t.render(),t.el});this.$(".videos").empty().append(e)}}),VideoView=Backbone.View.extend({template:Handlebars.compile($("#video-tpl").html()),render:function(){this.setElement(this.template(this.model.toJSON()))},events:{"click .deleteVideo":"deleteVideo"},deleteVideo:function(){console.log(this.model.attributes._id),this.model.destroy()}});